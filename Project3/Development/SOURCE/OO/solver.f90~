module solver_class
  
  type solver
     integer::Bodies=2
     real(8),dimension(2) :: mass
     real(8),dimension(2,3) :: position
     real(8),dimension(2,2) :: velocity
  contains
    procedure ::relative_position
    procedure ::forces

 end type solver

contains
  subroutine relative_position(system,relposition)
    implicit none

    class (solver),intent(in)::system
    integer :: i,j
    integer::NumBodies
    real(8),dimension(:,:,:),Allocatable :: relposition
    NumBodies = system%Bodies

    Allocate(relposition(NumBodies,Numbodies,3))
    
    do i=1,NumBodies
       do j =1,NumBodies
          if (i/=j) then
             relposition(j,i,1)=system%position(j,1)-system%position(i,1)
             relposition(j,i,2)=system%position(j,2)-system%position(i,2)
             relposition(j,i,3)=system%position(j,3)-system%position(i,3)
             relposition(j,i,4)=sqrt(relposition(j,i,1)**2.d0+relposition(j,i,2)**2.d0 +relposition(j,i,3)**2.d0)
          end if
       end do
    end do
    
    return 
  end subroutine relative_position


  subroutine forces(system,relposition,relforce)
    implicit none

    class(solver),intent(in)::system
    integer :: j,i
    integer:: NumBodies
    real(8),dimension(:,:),Allocatable::relforce
    real(8)::rrr,Fourpi2

    Fourpi2 = 4.d0*3.14159265*3.14159265
    Numbodies = system%Bodies

    Allocate(realforces(Numbodies,2))

    do i=1,bodies
       do j=1,bodies
          if(j/=i) then
             rrr=(relposition(j,i,4)**3.d0)
             relforce(i,1) += -Fourpi2*system%mass*relposition(i,j,1)/rrr
             relforce(i,2) += -Fourpi2*system%mass*relposition(i,j,2)/rrr
             relforce(i,3) += -Fourpi2*system%mass*relposition(i,j,3)/rrr
          end if
       end do
    end do

  end subroutine forces
  
end module solver_class
